{"version":3,"sources":["admin.js"],"names":["Admin","focused","elements","initElements","initHeader","header","document","querySelector","toggle_button","content","page_select","getElementById","addEventListener","classList","toggle","e","preventDefault","new_url","options","selectedIndex","getAttribute","location","pathname","href","self","editable_items","forEach","items","querySelectorAll","selector","length","element","id","item","key","value","textContent","trim","el","style","cursor","focusElement","stopImmediatePropagation","stopPropagation","kc","keyCode","which","metaKey","blur","saveElement","push","showMsg","name","csrf_token","page_id","data","FormData","set","axios","method","url","headers","then","res","catch","console","error","err","cur_item","backgroundColor","color","contentEditable","focus","updateElement","innerText","result","log","msg","notification","createElement","add","innerHTML","body","appendChild","setTimeout","window","admin"],"mappings":"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","file":"admin.js","sourcesContent":["class Admin {\r\n    constructor() {\r\n        this.focused = null\r\n        this.elements = []\r\n        this.initElements()\r\n        this.initHeader()\r\n    }\r\n\r\n    initHeader() {\r\n        const header = document.querySelector('.admin-header')\r\n        const toggle_button = header.querySelector('.toggle-page-content')\r\n        const content = header.querySelector('.page-content')\r\n        const page_select = document.getElementById('page')\r\n        toggle_button.addEventListener('click', e => {\r\n            content.classList.toggle('collapse')\r\n            e.preventDefault()\r\n        })\r\n        page_select.addEventListener('change', e => {\r\n            const new_url = page_select.options[page_select.selectedIndex].getAttribute('data-url')\r\n            if (new_url != location.pathname) {\r\n                location.href = new_url\r\n            }\r\n        })\r\n    }\r\n\r\n    initElements() {\r\n        const self = this\r\n        const editable_items = [\r\n            '.main-nav a', '.header .cta-wrapper > *', '.hero .info > *',\r\n            '.cta .swf > *', '.cfj .about > *', '.cfj .link',\r\n            '.zuu .about > *', '.zuu .link', '.about .inner > *',\r\n            '.map .inner > *', '.footer-nav a', '.services .swf > *',\r\n            '.services .swf > div p'\r\n        ]\r\n        editable_items.forEach(selector => {\r\n            let items = document.querySelectorAll(selector)\r\n            if (items.length) {\r\n                items.forEach(element => {\r\n                    if (!element.id) {\r\n                        return\r\n                    }\r\n                    let item = {\r\n                        key: element.id,\r\n                        value: element.textContent.trim(),\r\n                        el: element\r\n                    }\r\n                    element.style.cursor = 'cell'\r\n                    element.addEventListener('click', e => {\r\n                        self.focusElement(item)\r\n                        e.preventDefault()\r\n                        e.stopImmediatePropagation()\r\n                        e.stopPropagation()\r\n                        return false\r\n                    })\r\n                    element.addEventListener('keydown', e => {\r\n                        let kc = e.keyCode ? e.keyCode : e.which;\r\n                        if (e.metaKey && kc == 13) {\r\n                            element.blur()\r\n                        }\r\n                    })\r\n                    element.addEventListener('blur', e => {\r\n                        self.saveElement(item)\r\n                    })\r\n                    self.elements.push(item)\r\n                })\r\n            }\r\n        })\r\n        this.showMsg('Editing tools ready! ヽ(´▽`)/')\r\n    }\r\n\r\n    updateElement(name, value) {\r\n        const csrf_token = document.querySelector('meta[name=csrf-token]')\r\n        const page_id = document.getElementById('page').value\r\n        let data = new FormData\r\n        data.set(name, value)\r\n        data.set('page', page_id)\r\n        return axios({\r\n            method: 'post',\r\n            url: '/update.php',\r\n            data: data,\r\n            headers: {\r\n                'x-requested-with': 'XMLHttpRequest',\r\n                'x-csrf-token': csrf_token.content,\r\n                'Content-Type': 'multipart/form-data',\r\n            }\r\n        })\r\n            .then(res => res.data)\r\n            .catch(err => console.error(err))\r\n    }\r\n\r\n    focusElement(cur_item) {\r\n        this.focused = cur_item\r\n        this.elements.forEach(item => {\r\n            if (item != cur_item) {\r\n                item.el.style.backgroundColor = ''\r\n                item.el.style.color = ''\r\n                item.el.contentEditable = false\r\n            }\r\n        })\r\n        cur_item.el.style.backgroundColor = '#138771'\r\n        cur_item.el.style.color = '#2C3539'\r\n        cur_item.el.contentEditable = true\r\n        cur_item.el.focus()\r\n    }\r\n\r\n    saveElement(item) {\r\n        this.updateElement(item.key, item.el.innerText.trim()).then(result => {\r\n            if (result == 'success') {\r\n                item.el.style.backgroundColor = ''\r\n                item.el.style.color = ''\r\n                item.el.contentEditable = false\r\n            } else {\r\n                console.log(result)\r\n            }\r\n        })\r\n    }\r\n\r\n    showMsg(msg) {\r\n        const notification = document.createElement('div')\r\n        notification.classList.add('notify')\r\n        notification.innerHTML = msg\r\n        document.body.appendChild(notification)\r\n        setTimeout(() => {\r\n            notification.classList.add('hide')\r\n        }, 6000)\r\n    }\r\n}\r\n\r\nwindow.admin = new Admin\r\n"]}